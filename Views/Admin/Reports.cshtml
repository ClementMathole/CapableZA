@model List<Capableza.Web.Models.Report>
@using Capableza.Web.Models
@{
    ViewData["Title"] = "Reports";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .card { border: none; border-radius: 0.75rem; box-shadow: 0 .125rem .25rem rgba(0,0,0,.075); }
    .card-header { background-color: #f8f9fa; border-bottom: 1px solid #dee2e6; font-weight: 600; color: #495057;}
    .card-title { font-size: 1rem; font-weight: 600; color: #343a40; }
    .form-label { font-size: 0.9rem; font-weight: 500; color: #495057; }
    .form-control, .form-select { font-size: 0.95rem; border-color: #ced4da; border-radius: 0.375rem; }
    .form-control:focus, .form-select:focus { border-color: #86b7fe; box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25); }
    .btn-primary-teal { background-color: #0F6F84; border-color: #0F6F84; color: white; }
    .btn-primary-teal:hover { background-color: #0B5B6D; border-color: #0B5B6D; }
    .text-danger { font-size: 0.8rem; }
    .table thead th { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.5px; background-color: #f8f9fa;}
    .table tbody td { font-size: 0.9rem; vertical-align: middle; }
    .btn-xs { padding: 0.15rem 0.5rem; font-size: 0.75rem; line-height: 1.4; }
    .action-icon { color: #6c757d; text-decoration: none; padding: 0.2rem; }
    .action-icon:hover { color: #0F6F84; }
    .btn-link-icon { background: none; border: none; padding: 0.2rem; margin: 0; vertical-align: middle; }
    .action-icon-delete:hover { color: #dc3545; }
</style>

<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-1 pb-2 mb-3 border-bottom">
    <h1 class="h2">@ViewData["Title"]</h1>
    <div class="d-flex align-items-center header-actions">
        @*<div class="input-group input-group-sm me-2 d-none d-md-flex" style="max-width: 250px;">
            <span class="input-group-text bg-light border-0 text-muted"><i class="fa fa-search"></i></span>
            <input type="text" class="form-control form-control-sm bg-light border-0" placeholder="Search reports...">
        </div>*@
    </div>
</div>

<div class="row g-4"> 
    <div class="col-lg-4">
        <div class="card shadow-sm h-100">
            <div class="card-header py-3"> 
                <h5 class="mb-0 card-title">Generate New Report</h5>
            </div>
            <div class="card-body p-4">
                <form asp-action="GenerateReport" method="post">
                    @Html.AntiForgeryToken() 
                    <div class="mb-3">
                        <label for="reportType" class="form-label">Report Type</label>
                        <select name="reportType" class="form-select" required>
                            <option value="">-- Select Type --</option>
                            <option>Skills overview</option>
                            <option>Employee Performance</option>
                            <option>Training Completion</option>
                            <option>Audit Log</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="positionOrRole" class="form-label">Job Title/Role Filter</label>
                        <select name="positionOrRole" class="form-select">
                            <option>All Positions</option>
                            <option>Designer</option>
                            <option>Developer</option>
                            <option>Manager</option>
                            <option>Analyst</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="dateRange" class="form-label">Date Range</label>
                        <select name="dateRange" class="form-select"> 
                            <option>Last 30 Days</option>
                            <option>Last 90 Days</option>
                            <option>Last Year</option>
                            <option>All Time</option>
                        </select>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" value="true" name="includeVisualizations" id="includeVisualizations">
                        <label class="form-check-label" for="includeVisualizations">
                            Include Visualizations
                        </label>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary-teal">
                            <i class="fa fa-download me-1"></i> Generate
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-lg-8">
        <div class="card shadow-sm h-100">
            <div class="card-header py-3">
                 <h5 class="mb-0 card-title">Existing Reports</h5>
            </div>
            <div class="card-body p-0">
                 @if (Model.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-sm table-hover mb-0 align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th class="px-3">Type</th>
                                    <th>Parameters</th>
                                    <th>Generated</th>
                                    <th class="text-end px-3">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var report in Model)
                                {
                                    <tr>
                                        <td class="px-3 fw-medium">@report.ReportType</td>
                                        <td class="small text-muted">
                                            @report.PositionOrRole <br> @report.DateRange
                                        </td>
                                        <td class="small text-muted">@report.CreatedAtDateTime.ToString("yyyy-MM-dd HH:mm")</td>
                                        <td class="text-end px-3">
                                            <a asp-action="ReportDetails" asp-route-id="@report.Id"
                                               class="btn btn-xs btn-outline-primary me-1 @(string.IsNullOrEmpty(report.FileUrl) ? "disabled" : "")"
                                               title="View Report Details">
                                                <i class="fa fa-eye fa-fw"></i>
                                            </a>
                                            <a href="@report.FileUrl" target="_blank"
                                               class="btn btn-xs btn-outline-secondary me-1 @(string.IsNullOrEmpty(report.FileUrl) || report.FileUrl.Contains("placehold.co") ? "disabled" : "")"
                                               title="Download Report">
                                                <i class="fa fa-download fa-fw"></i>
                                            </a>
                                            <form asp-action="DeleteReport" method="post" class="d-inline">
                                                @Html.AntiForgeryToken()
                                                <input type="hidden" name="reportId" value="@report.Id" />
                                                <button type="submit" class="btn btn-xs btn-outline-danger" onclick="return confirm('Are you sure you want to delete this report?');" title="Delete Report">
                                                    <i class="fa fa-trash fa-fw"></i>
                                                </button>
                                            </form>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <div class="text-center text-muted p-5">
                         <i class="fa fa-file-excel fa-3x mb-3 text-secondary"></i>
                         <p>No reports generated yet.</p>
                         <p class="small">Use the form on the left to generate your first report.</p>
                    </div>
                }
            </div>
        </div> 
    </div>
</div>